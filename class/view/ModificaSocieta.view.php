<?phpif (!defined("_BASE_DIR_"))    exit();include_controller('ModificaSocieta');include_model('Societa');include_model('Polizza');include_formview('FormView');class ModificaSocieta extends ViewWithForm{    private $completo;    private $ctrl;    private $pulsanti;    private $idSoc;    /**     * @param int $idsoc     * @param boolean $completo true per modificare tutti i dati     * @param callable $callback [opz] funzione da chiamare in caso di operazione effettuata correttamente     * @param boolean $pulsanti [def:true] true per stampare i pulsanti e chiudere il form     */    public function __construct($idsoc, $completo, $callback, $pulsanti = true)    {        $this->completo = $completo;        $this->ctrl = new ModificaSocietaCtrl($idsoc, $completo, $callback);        if ($pulsanti)            $this->ctrl->getForm()->addSubmit('Modifica');        $this->form = new FormView($this->ctrl->getForm());        $this->idSoc = $idsoc;        $this->pulsanti = $pulsanti;    }    /**     * @param FormView $fv     * @param unknown $nome     */    private function stampaEl($fv, $nome)    {        $fv->stampa($nome);        echo $this->ctrl->getErrore($nome);    }    public function stampa()    {        $fv = $this->form;        $fv->stampaInizioForm();        ?>        <div class="form-horizontal">          <div class="control-group">            <label class="control-label" for="form_<?php echo FormSocieta::NOME; ?>">Nome:</label>            <div class="controls"><?php $this->stampaEl($fv, FormSocieta::NOME); ?></div>          </div>          <div class="control-group">            <label class="control-label" for="form_<?php echo FormSocieta::NOME_BREVE; ?>">Nome breve:</label>            <div class="controls"><?php $this->stampaEl($fv, FormSocieta::NOME_BREVE); ?></div>          </div>          <?php          if ($this->completo)          {              ?>              <div class="control-group">                <label class="control-label" for="form_<?php echo FormSocieta::COD_ACSI; ?>">Codice ACSI:</label>                <div class="controls"><?php $this->stampaEl($fv, FormSocieta::COD_ACSI); ?></div>              </div>              <div class="control-group">                <label class="control-label" for="form_<?php echo FormSocieta::FILE_ACSI; ?>">File ACSI:</label>                <div class="controls"><?php $this->stampaEl($fv, FormSocieta::FILE_ACSI); ?></div>              </div>          <?php } //if completo    ?>          <div class="control-group">            <label class="control-label" for="form_<?php echo FormSocieta::DATA_COST; ?>">Data costituzione:</label>            <div class="controls"><?php $this->stampaEl($fv, FormSocieta::DATA_COST); ?></div>          </div>          <div class="control-group">            <label class="control-label" for="form_<?php echo FormSocieta::P_IVA; ?>">Partita IVA:</label>            <div class="controls"><?php $this->stampaEl($fv, FormSocieta::P_IVA); ?></div>          </div>          <div class="control-group">            <label class="control-label" for="form_<?php echo FormSocieta::SEDE_LEG; ?>">Sede legale:</label>            <div class="controls"><?php $this->stampaEl($fv, FormSocieta::SEDE_LEG); ?></div>          </div>          <div class="control-group">            <label class="control-label" for="form_<?php echo FormSocieta::REGIONE; ?>">Regione:</label>            <div class="controls"><?php $this->stampaEl($fv, FormSocieta::REGIONE); ?></div>          </div>          <div class="control-group">            <label class="control-label" for="form_<?php echo FormSocieta::PROV; ?>">Provincia:</label>            <div class="controls"><?php $this->stampaEl($fv, FormSocieta::PROV); ?></div>          </div>          <div class="control-group">            <label class="control-label" for="form_<?php echo FormSocieta::ID_COMUNE; ?>">Comune:</label>            <div class="controls"><?php $this->stampaEl($fv, FormSocieta::ID_COMUNE); ?></div>          </div>          <div class="control-group">            <label class="control-label" for="form_<?php echo FormSocieta::CAP; ?>">Cap:</label>            <div class="controls"><?php $this->stampaEl($fv, FormSocieta::CAP); ?></div>          </div>          <div class="control-group">            <label class="control-label" for="form_<?php echo FormSocieta::TEL; ?>">Telefono:</label>            <div class="controls"><?php $this->stampaEl($fv, FormSocieta::TEL); ?></div>          </div>          <div class="control-group">            <label class="control-label" for="form_<?php echo FormSocieta::FAX; ?>">Fax:</label>            <div class="controls"><?php $this->stampaEl($fv, FormSocieta::FAX); ?></div>          </div>          <div class="control-group">            <label class="control-label" for="form_<?php echo FormSocieta::EMAIL; ?>">Email:</label>            <div class="controls"><?php $this->stampaEl($fv, FormSocieta::EMAIL); ?></div>          </div>          <div class="control-group">            <label class="control-label" for="form_<?php echo FormSocieta::WEB; ?>">Web:</label>            <div class="controls"><?php $this->stampaEl($fv, FormSocieta::WEB); ?></div>          </div>          <div class="control-group">            <label class="control-label" for="form_<?php echo "Polizza"; ?>">Polizza:</label>            <?php            $obj_polizza = Polizza::elenco();            $nome_polizza = $obj_polizza[2]->getNomePolizza();            $polizza = new Polizza('polizze_stipulate');            $array_dati_polizza = array("id_polizza" => 2, "idtesserato" => 0, "idsocieta" => $this->idSoc, "data_stipula" => date("d-m-Y"), "data_da" => NULL, "data_a" => NULL, "tipo_polizza" => "1");            $polizza->setDati($array_dati_polizza);            $num_rows = $polizza->SearchRow();            $checked = "";            if ($num_rows > 0)            {                $checked = "checked";            }           $array_dati_polizza =  $polizza->getPolizza(1);           $polizza->setDati($array_dati_polizza);                       if ( !empty($array_dati_polizza))                $polizza_scaduto = $polizza->polizzaScaduto();           else{               $polizza->setDati($array_dati_polizza);               $polizza_scaduto = true;           }            if (!$polizza_scaduto)            {                print '<div class="controls">'.$nome_polizza.'</div>';            } else                print '  <div class="controls"> <input type="checkbox" ' . $checked . '  name="polizze_assicurative" value="2"/> ' . $nome_polizza . ' </div>';                                   ?>          </div>          <?php          if ($this->pulsanti)          {              ?>              <div class="control-group">                <div class="controls"><?php $fv->stampaSubmit(array('class' => 'btn-primary')); ?><a class='btn' href='javascript:history.back();'>Annulla</a></div>              </div>          <?php } //if pulsanti    ?>        </div>        <?php        if ($this->pulsanti)            $fv->stampaFineForm();    }}